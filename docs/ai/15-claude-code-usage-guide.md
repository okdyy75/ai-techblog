# Claude Code完全ガイド：Anthropic公式CLIツールの使い方

## 概要

Claude Codeは、Anthropicが開発した公式のコマンドラインインターフェース（CLI）ツールです。ターミナル上で動作するインタラクティブなAIアシスタントとして、コード生成、ファイル編集、Git操作、タスク管理など、ソフトウェア開発のあらゆる場面で開発者をサポートします。本記事では、Claude Codeの基本的な使い方から高度な活用方法まで、実践的なガイドを提供します。

## Claude Codeとは

### 主な特徴

- **ターミナルベースのAIアシスタント**: コマンドラインから直接Claudeとやり取り
- **ファイル操作**: 読み取り、編集、作成などの操作をAIが実行
- **Git統合**: コミット、プッシュ、ブランチ管理などをサポート
- **コード生成**: 複数の言語でのコード生成とリファクタリング
- **タスク管理**: 複雑なタスクの計画と追跡
- **インタラクティブな対話**: 自然言語でのコミュニケーション

### 他のコードアシスタントとの違い

| 特徴 | Claude Code | GitHub Copilot | Cursor |
|------|-------------|----------------|--------|
| 実行環境 | CLI/ターミナル | IDE拡張機能 | 専用エディタ |
| ファイル操作 | 直接実行可能 | 制限あり | 可能 |
| Git統合 | フル機能 | 基本機能 | フル機能 |
| タスク管理 | 組み込み | なし | 基本機能 |
| 対話形式 | 自然言語 | コメント+補完 | チャット形式 |

## インストールと初期設定

### 前提条件

```bash
# Node.js 18以上が必要
node --version

# npmまたはyarnがインストールされていること
npm --version
```

### インストール

```bash
# npmでグローバルインストール
npm install -g @anthropic-ai/claude-code

# または、npxで直接実行
npx @anthropic-ai/claude-code
```

### 初回セットアップ

```bash
# Claude Codeを起動
claude-code

# 初回起動時にAPIキーの設定を求められます
# AnthropicのコンソールからAPIキーを取得してください
# https://console.anthropic.com/
```

### 環境変数での設定

```bash
# .bashrcまたは.zshrcに追加
export ANTHROPIC_API_KEY="your-api-key-here"

# または、プロジェクトごとの.envファイルに設定
echo "ANTHROPIC_API_KEY=your-api-key-here" > .env
```

## 基本的な使い方

### 起動と終了

```bash
# Claude Codeを起動
claude-code

# 特定のディレクトリで起動
claude-code /path/to/project

# 終了するには
exit
# または Ctrl+D
```

### ファイルの読み取り

```bash
# Claude Codeのプロンプトで
> このファイルの内容を読んで説明してください: src/index.js

> README.mdの内容を要約してください

> package.jsonの依存関係を確認してください
```

### ファイルの編集

```bash
# 既存ファイルの編集
> src/utils.jsのexportFormatDate関数を改善してください

> コメントを日本語から英語に翻訳してください

# 特定の行を変更
> index.ts:42の型定義を修正してください
```

### 新規ファイルの作成

```bash
> TypeScriptでユーザー認証のヘルパー関数を作成してください
> ファイル名はauth.tsにしてください

> テスト用のモックデータファイルを作成してください
```

## 実践的な活用例

### 1. コードレビューとリファクタリング

```bash
# コードレビュー
> src/components/UserList.tsxをレビューして改善提案をしてください

# リファクタリング
> このコンポーネントを関数コンポーネントからカスタムフックに分離してください

# パフォーマンス最適化
> この関数のパフォーマンスを改善してください
```

### 2. テストコードの生成

```bash
# 単体テスト生成
> src/utils/validation.tsのテストコードをJestで生成してください

# E2Eテスト生成
> ログイン機能のE2EテストをPlaywrightで書いてください

# カバレッジの向上
> テストカバレッジが低い関数のテストを追加してください
```

### 3. ドキュメント作成

```bash
# API ドキュメント
> このAPIエンドポイントのドキュメントをOpenAPI形式で作成してください

# README生成
> このプロジェクトのREADME.mdを作成してください

# JSDoc追加
> すべての関数にJSDocコメントを追加してください
```

### 4. バグ修正

```bash
# エラーの調査
> このエラーメッセージの原因を調査してください: TypeError: Cannot read property 'map' of undefined

# デバッグ
> なぜこのコードが期待通りに動作しないのか調べてください

# 修正の実装
> この型エラーを修正してください
```

### 5. 新機能の実装

```bash
# 機能の設計
> ユーザープロフィール編集機能の実装計画を立ててください

# 段階的な実装
> まずバックエンドのAPIを実装してください
> 次にフロントエンドのフォームを作成してください

# 統合
> バックエンドとフロントエンドを統合してください
```

## Git操作の活用

### ブランチ管理

```bash
# 新しいブランチを作成
> feature/user-authentication という名前のブランチを作成してチェックアウトしてください

# ブランチの確認
> 現在のブランチと未コミットの変更を確認してください
```

### コミットの作成

```bash
# 変更内容の確認
> git statusとgit diffを確認してください

# コミットの作成
> これらの変更をコミットしてください。適切なコミットメッセージを生成してください

# 特定のファイルのみコミット
> src/auth.tsの変更だけをコミットしてください
```

### プルリクエストの作成

```bash
# プルリクエストを作成
> この変更のプルリクエストを作成してください

# 自動的にタイトルと説明を生成
> 変更内容を分析して、適切なPRタイトルと説明を作成してください
```

## 高度な機能

### タスク管理

Claude Codeは内部的にタスク管理機能を持ち、複雑な作業を分解して追跡します。

```bash
# 複雑なタスクを依頼
> このアプリケーションに検索機能を追加してください

# Claude Codeは自動的にタスクを分解
# 1. データベーススキーマの更新
# 2. バックエンドの検索API実装
# 3. フロントエンドの検索UIを実装
# 4. テストの作成
# 5. ドキュメントの更新
```

### エージェントの活用

Claude Codeは特定のタスクに特化したエージェントを使用できます。

```bash
# コードベース探索エージェント
> このプロジェクトのエラーハンドリングの実装を調査してください

# 一般的なタスクエージェント
> プロジェクト全体の型安全性を向上させてください
```

### パラレル実行

```bash
# 複数の独立したタスクを並列実行
> 以下のタスクを並列で実行してください:
> 1. ESLintの設定を追加
> 2. Prettierの設定を追加
> 3. Huskyでpre-commitフックを設定
```

## ベストプラクティス

### 1. 明確な指示を出す

```bash
# 悪い例
> ファイルを直して

# 良い例
> src/components/Button.tsxのonClick処理で、
> 非同期エラーを適切にキャッチして、
> ユーザーにトーストメッセージで通知してください
```

### 2. コンテキストを提供する

```bash
# 関連ファイルを事前に読み込ませる
> まずsrc/types/user.tsを確認してください
> その型定義に基づいて、ユーザー一覧コンポーネントを実装してください
```

### 3. 段階的に進める

```bash
# 一度に全てを要求するのではなく
> まず基本的な構造を作成してください
> 動作を確認してから、エラーハンドリングを追加してください
> 最後にテストを書いてください
```

### 4. 生成されたコードのレビュー

AIが生成したコードは必ずレビューしてください：
- セキュリティの問題がないか確認
- パフォーマンスの考慮
- プロジェクトのコーディング規約に準拠しているか
- エッジケースの処理

### 5. プロジェクト固有の設定

```bash
# .claudeフォルダでプロジェクト固有の設定を管理
.claude/
  commands/        # カスタムスラッシュコマンド
  hooks/          # フック設定
  settings.json   # プロジェクト設定
```

## トラブルシューティング

### APIキーのエラー

```bash
# APIキーが無効な場合
Error: Invalid API key

# 解決方法
export ANTHROPIC_API_KEY="新しいAPIキーを設定"
```

### ファイルアクセスエラー

```bash
# 権限エラー
Error: EACCES: permission denied

# 解決方法
chmod +x file.sh  # 適切な権限を付与
```

### Git操作のエラー

```bash
# プッシュが403エラーで失敗
HTTP 403 forbidden

# 原因：ブランチ名が正しくない
# Claude Codeはclaude/で始まるブランチにのみプッシュ可能
```

### ネットワークエラー

```bash
# ネットワークタイムアウト
> リトライしてください

# Claude Codeは自動的に指数バックオフでリトライします
```

## 料金とコスト管理

### API使用料金

Claude CodeはClaude APIを使用するため、使用量に応じた料金が発生します。

```bash
# 使用モデルの確認
# Claude Code は主にClaude 3.5 Sonnetを使用

# 入力: $3.00 / 1M tokens
# 出力: $15.00 / 1M tokens
```

### コスト最適化のヒント

1. **不要なファイルの読み込みを避ける**: 大きなファイルは必要な部分だけ読み込む
2. **効率的なプロンプト**: 明確で簡潔な指示を出す
3. **キャッシュの活用**: 同じ質問を繰り返さない
4. **適切なスコープ**: プロジェクト全体ではなく、必要な部分のみを対象にする

## 他のツールとの統合

### VS Code統合

```bash
# VS Codeのターミナルから使用
# 統合ターミナルでclaude-codeを起動
```

### CI/CD統合

```yaml
# GitHub Actions での使用例
name: Claude Code Review
on: [pull_request]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run Claude Code
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          npx @anthropic-ai/claude-code "このPRの変更をレビューしてください"
```

### カスタムスクリプト

```bash
#!/bin/bash
# claude-review.sh
# 自動コードレビュースクリプト

echo "変更されたファイルをレビューします..."
changed_files=$(git diff --name-only HEAD~1)

for file in $changed_files; do
  claude-code "このファイルの変更をレビュー: $file"
done
```

## セキュリティとプライバシー

### 機密情報の取り扱い

```bash
# .envファイルや認証情報を含むファイルは慎重に扱う
> .envファイルは読み込まないでください

# 環境変数の使用を推奨
export DATABASE_URL="..."  # Claude Codeには見えない
```

### コードの外部送信

- Claude CodeはAnthropicのAPIにリクエストを送信します
- 機密性の高いコードを扱う場合は、企業のセキュリティポリシーを確認
- オンプレミスでの実行オプションについてはAnthropicに問い合わせ

## まとめ

Claude Codeは、ターミナルベースの強力なAIアシスタントとして、日常的なコーディング作業から複雑なプロジェクトのリファクタリングまで、幅広い開発タスクをサポートします。

### 主な利点

- **高い生産性**: 反復的なタスクの自動化
- **コード品質の向上**: AIによるレビューと最適化提案
- **学習の加速**: 新しい技術の迅速な習得
- **Git統合**: シームレスなバージョン管理
- **柔軟性**: プロジェクトに応じたカスタマイズ

### おすすめの活用シーン

1. **新規プロジェクトの立ち上げ**: ボイラープレートコードの生成
2. **レガシーコードのモダナイゼーション**: リファクタリングと最新化
3. **テストカバレッジの向上**: 自動テスト生成
4. **ドキュメント整備**: README、API ドキュメントの作成
5. **コードレビュー**: AIによる第一次レビュー

Claude Codeを日常のワークフローに組み込むことで、より創造的な問題解決に集中できる時間を確保できます。

### 参考リンク

- [Claude Code 公式ドキュメント](https://docs.claude.com/en/docs/claude-code)
- [Anthropic Console](https://console.anthropic.com/)
- [Claude API ドキュメント](https://docs.anthropic.com/)
- [GitHub: claude-code](https://github.com/anthropics/claude-code)

---

*最終更新: 2025年10月*
